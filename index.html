<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>我的二手清单 | Second‑hand Listings | Elenco usato</title>
  <meta name="description" content="二手物品展示页：支持多图（主图+gallery）、价格对比（原价/现价/节省）、复制直达链接、参考购买链接。" />
  <style>
    :root { --bg:#0b0c10; --card:#111218; --muted:#8b90a6; --fg:#eaeaf2; --border:#1a1c24; --chip:#1b1d26; --brand:#7c9cff; }
    html,body{height:100%}
    body{margin:0;background:#0b0c10;color:var(--fg);font:15px/1.65 system-ui,-apple-system,Segoe UI,Roboto,'PingFang SC','Noto Sans CJK SC',Arial}
    .container{max-width:1120px;margin:0 auto;padding:24px 16px 80px}
    header{display:grid;gap:12px;margin-bottom:14px}
    .title{display:flex;align-items:baseline;gap:12px;flex-wrap:wrap}
    .title h1{margin:0;font-size:26px}
    .subtitle{color:var(--muted);font-size:12.5px}
    .grid{display:grid;gap:14px;grid-template-columns:repeat(1,minmax(0,1fr));margin-top:14px}
    @media(min-width:560px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:1000px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{position:relative;background:linear-gradient(180deg,#12131a,#0f1016);border:1px solid var(--border);border-radius:16px;overflow:hidden}
    .thumb{aspect-ratio:4/3;width:100%;object-fit:cover;display:block;background:#0a0b10;cursor:pointer}
    .badge{position:absolute;top:10px;right:10px;background:rgba(10,11,20,.6);border:1px solid var(--border);color:#fff;padding:6px 10px;border-radius:12px;font-weight:700;font-size:13px}
    .content{padding:12px 14px 14px;display:grid;gap:8px}
    .meta{display:flex;gap:8px;flex-wrap:wrap}
    .meta .tag{background:var(--chip);border:1px solid var(--border);color:#b9bfd7;border-radius:8px;padding:4px 8px;font-size:12px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{flex:1;text-align:center;padding:9px 10px;border-radius:10px;border:1px solid var(--border);background:#151723;color:#e6e9f6;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(180deg,#2f3cff,#6f86ff);border:none}
    .btn.link{background:#0d1117;color:#7c9cff;text-decoration:underline;flex:1}
    .pricebox{display:flex;flex-direction:column;gap:4px}
    .line{display:flex;align-items:baseline;gap:8px;flex-wrap:wrap}
    .oldprice{color:#9aa2b2;text-decoration:line-through;font-size:13px}
    .newprice{color:#ffd2d6;font-size:18px;font-weight:800}
    .save{color:#8bf0b8;font-weight:700;font-size:12.5px}
    .thumbs{display:flex;gap:6px;flex-wrap:wrap}
    .thumbs img{width:56px;height:42px;object-fit:cover;border:1px solid var(--border);border-radius:8px;opacity:.85;cursor:pointer}
    .thumbs img.active{outline:2px solid var(--brand);opacity:1}
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:9999}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw;max-height:86vh;object-fit:contain}
    .lb-nav{position:fixed;inset:0;display:flex;align-items:center;justify-content:space-between;pointer-events:none}
    .lb-btn{pointer-events:auto;user-select:none;cursor:pointer;background:rgba(255,255,255,.12);border:1px solid #555;color:#fff;padding:10px 14px;border-radius:12px;margin:0 14px;font-weight:800}
    .lb-close{position:fixed;top:16px;right:16px}
    footer{margin-top:18px;color:var(--muted);font-size:12px;display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
    .count{color:#a6add0}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <h1>二手物品清单</h1>
        <span class="subtitle">支持多图（主图+gallery） · 原价/现价/节省 对比 · 参考链接</span>
      </div>
    </header>

    <section class="grid" id="grid"></section>

    <footer>
      <div class="count" id="count">0 items</div>
      <div id="contact"></div>
    </footer>
  </div>

  <!-- Lightbox 容器 -->
  <div class="lightbox" id="lightbox">
    <button class="lb-btn lb-close" id="lbClose">✕</button>
    <img id="lbImg" alt="preview" />
    <div class="lb-nav">
      <button class="lb-btn" id="lbPrev">◀</button>
      <button class="lb-btn" id="lbNext">▶</button>
    </div>
  </div>

  <script>
    const I18N={ zh:{btnCopy:'CopyLink',btnWant:'我想要/I WANT',btnLink:'参考链接Link🔗',priceOld:'原价',priceNow:'现价',priceSave:'节省'}, en:{btnCopy:'Copy link',btnWant:'I want it',btnLink:'Reference link',priceOld:'Original',priceNow:'Now',priceSave:'Save'}, it:{btnCopy:'Copia link',btnWant:'Mi interessa',btnLink:'Link di riferimento',priceOld:'Prezzo originale',priceNow:'Prezzo attuale',priceSave:'Risparmi'} };
    const LANG='zh';
    const seller={ contact:'WeChat: your_wechat · Email: meii.della.serena@gmail.com', defaultCurrency:'EUR' };
    const $=s=>document.querySelector(s); const byId=id=>document.getElementById(id);
    function fmt(n,c){try{return new Intl.NumberFormat(undefined,{style:'currency',currency:c,maximumFractionDigits:n%1?2:0}).format(n)}catch(e){return `${c} ${n}`}}
    function saveCalc(it){const o=Number(it.originalPrice||0),p=Number(it.price||0);if(!o||!p||p>=o)return null;const s=o-p;const r=Math.round(s/o*100);return{s,pct:r}}

    // Lightbox 状态
    const lbEl=byId('lightbox'); const lbImg=byId('lbImg'); const lbPrev=byId('lbPrev'); const lbNext=byId('lbNext'); const lbClose=byId('lbClose');
    let lbList=[], lbIdx=0;
    function openLB(list,start=0){ lbList=list; lbIdx=start; lbImg.src=lbList[lbIdx]; lbEl.classList.add('open'); }
    function closeLB(){ lbEl.classList.remove('open'); }
    function navLB(d){ if(!lbList.length) return; lbIdx=(lbIdx+d+lbList.length)%lbList.length; lbImg.src=lbList[lbIdx]; }
    lbPrev.onclick=()=>navLB(-1); lbNext.onclick=()=>navLB(1); lbClose.onclick=closeLB; lbEl.addEventListener('click',e=>{ if(e.target===lbEl) closeLB(); });
    document.addEventListener('keydown',e=>{ if(!lbEl.classList.contains('open')) return; if(e.key==='Escape') closeLB(); if(e.key==='ArrowLeft') navLB(-1); if(e.key==='ArrowRight') navLB(1); });

    function createCard(item){
      const dict=I18N[LANG]; const currency=item.currency||seller.defaultCurrency;
      const el=document.createElement('article'); el.className='card'; el.id=item.id||('item-'+Math.random().toString(36).slice(2,8));
      const mainImg=item.img || (item.gallery&&item.gallery[0]);
      const savings=saveCalc(item);
      el.innerHTML=`
        <div class="media">
          <img class="thumb" src="${mainImg}" alt="${item.title}">
          <div class="badge">${fmt(item.price,currency)}</div>
        </div>
        <div class="content">
          <h3 class="itemTitle">${item.title}</h3>
          <div class="desc">${item.desc||''}</div>
          ${item.originalPrice? `<div class='pricebox'><div class='line'><span class='oldprice'>${dict.priceOld}: ${fmt(item.originalPrice,currency)}</span><span class='newprice'>${dict.priceNow}: ${fmt(item.price,currency)}</span>${savings? `<span class='save'>${dict.priceSave}: ${fmt(savings.s,currency)} (~${savings.pct}%)</span>`:''}</div></div>`:''}
          <div class="meta"></div>
          <div class="actions">
            <button class="btn" data-copy="#${el.id}">${dict.btnCopy}</button>
            <a class="btn primary" href="mailto:?subject=${encodeURIComponent('Inquiry: '+item.title)}&body=${encodeURIComponent(location.href.split('#')[0]+'#'+el.id)}">${dict.btnWant}</a>
            ${item.link? `<a class="btn link" href="${item.link}" target="_blank">${dict.btnLink}</a>`:''}
          </div>
        </div>`;

      // 缩略图条
      if(Array.isArray(item.gallery) && item.gallery.length){
        const bar=document.createElement('div'); bar.className='thumbs';
        item.gallery.forEach((src,idx)=>{
          const t=document.createElement('img'); t.src=src; t.alt=item.title+'-'+(idx+1);
          if(src===mainImg) t.classList.add('active');
          t.addEventListener('click',()=>{
            el.querySelector('.thumb').src=src;
            bar.querySelectorAll('img').forEach(i=>i.classList.remove('active'));
            t.classList.add('active');
          });
          bar.appendChild(t);
        });
        el.querySelector('.content').insertBefore(bar, el.querySelector('.actions'));
      }

      // 复制直达链接
      el.querySelector('[data-copy]').addEventListener('click',e=>{
        const h=e.currentTarget.getAttribute('data-copy'); const url=location.href.split('#')[0]+h;
        navigator.clipboard?.writeText(url).then(()=>{e.currentTarget.textContent='✔'; setTimeout(()=>e.currentTarget.textContent=dict.btnCopy,900)});
      });

      // 主图打开 lightbox
      el.querySelector('.thumb').addEventListener('click',()=>{
        const list = (Array.isArray(item.gallery)&&item.gallery.length)? item.gallery : [mainImg];
        const current = el.querySelector('.thumb').getAttribute('src');
        const startIndex = Math.max(0, list.indexOf(current));
        openLB(list, startIndex);
      });

      return el;
    }

    function render(data){
      const grid=byId('grid'); grid.innerHTML='';
      (data.items||[]).forEach(it=> grid.appendChild(createCard(it)));
      byId('count').textContent = `${data.items.length} items`;
      byId('contact').innerHTML = seller.contact;
      if(location.hash){ document.querySelector(location.hash)?.scrollIntoView({behavior:'smooth',block:'center'}); }
    }

    function setup(data){ render(data); }
  </script>

  <script>
    window.APP_DATA = {
      items: [
        {
          id: 'jd1_mirror',
          title: "圆角设计感全身镜",
          desc: '53 x 163 cm, 可悬挂于墙壁或落地，适合客厅更衣室，金色，',
          price: 137.59,
          originalPrice: 38,
          currency: 'EUR',
          category: '家电',
          condition: '九成新',
          location: 'Como/Milano',
          img: 'assets/jd/jd1_mirror/id1_3.png',
          gallery: [
            'assets/jd/jd1_mirror/id1_1.png',
            'assets/jd/jd1_mirror/id1_2.jpg',
            'assets/jd/jd1_mirror/id1_3.png'
          ],
          date: '2025-08-24',
          status: 'available',
          link: 'https://www.amazon.it/dp/B0C58ZJV6R?ref=ppx_yo2ov_dt_b_fed_asin_title'
        },
        {
          id: 'SKU-002',
          title: '飞利浦空气炸锅 4.1L / Philips Airfryer / Friggitrice ad aria',
          desc: '适合 1-3 人，干净好用，赠烘焙纸。/ For 1–3 ppl, clean, includes liners. / Per 1–3 persone, pulita, con liner.',
          price: 35,
          originalPrice: 99,
          category: '家电',
          condition: '良好',
          location: 'Milano - Lambrate',
          img: 'https://images.unsplash.com/photo-1556912998-c57cc6b63cd7?q=80&w=1200&auto=format&fit=crop',
          date: '2025-08-20',
          status: 'reserved',
          link: 'https://www.philips.com'
        },
        {
          id: 'SKU-003',
          title: '全身落地镜 150×40cm / Full‑length mirror / Specchio a figura intera',
          desc: '9成新，带支架，可靠墙，搬家出。/ Very good condition, with stand, free‑standing. / Ottime condizioni, con supporto.',
          price: 35,
          originalPrice: 137.59,
          category: '家具',
          condition: '九成新',
          location: 'Milano - Porta Romana',
          img: 'assets/jd/jd1_mirror/id1_2.jpg',
          gallery: [
            'assets/jd/jd1_mirror/id1_1.jpg',
            'assets/jd/jd1_mirror/id1_2.jpg',
            'assets/jd/jd1_mirror/id1_3.jpg'
          ],
          date: '2025-08-18',
          status: 'sold',
          link: 'https://www.ikea.com'
        }
      ]
    };

    setup(window.APP_DATA);
  </script>
</body>
</html>
