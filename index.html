<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>我的二手清单 | Second‑hand Listings | Elenco usato</title>
  <!-- 改为中英双语描述（说明 + 截止日期），倒计时在页面可见处动态显示 -->
  <meta name="description" content="Hi～欢迎光临 Lina 的二手杂货铺｜毕业出 家具·学习用品·衣物 等，先到先得，营业至 10/03；Welcome to Lina’s preloved shop — furniture, study supplies, clothing; open till Oct 3." />
  <style>
    :root { --bg:#0b0c10; --card:#111218; --muted:#8b90a6; --fg:#eaeaf2; --border:#1a1c24; --chip:#1b1d26; --brand:#7c9cff; --ok:#8bf0b8; --warn:#ffd2d6; }
    body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.65 system-ui,-apple-system,Segoe UI,Roboto,'PingFang SC','Noto Sans CJK SC',Arial}
    .container{max-width:1160px;margin:0 auto;padding:28px 16px 96px}
    header{display:grid;gap:10px;margin-bottom:16px}
    .title{display:flex;align-items:baseline;gap:12px;flex-wrap:wrap}
    .title h1{margin:0;font-size:28px;letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:12.5px}
    .toolbar{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:6px;color:var(--muted);font-size:12px}
    .filter{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    select{background:#151723;color:var(--fg);border:1px solid var(--border);border-radius:8px;padding:4px 8px;font-size:13px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(1,minmax(0,1fr));margin-top:16px}
    @media(min-width:640px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:1040px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{position:relative;background:linear-gradient(180deg,#141622,#0e1017);border:1px solid var(--border);border-radius:16px;overflow:hidden;transition:transform .18s ease, box-shadow .18s ease}
    .card:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(0,0,0,.24)}
    .thumb{aspect-ratio:4/3;width:100%;object-fit:cover;display:block;background:#0a0b10;cursor:pointer}
    .badge{position:absolute;top:10px;right:10px;background:rgba(10,11,20,.6);border:1px solid var(--border);color:#fff;padding:6px 10px;border-radius:12px;font-weight:800;font-size:13px}
    .content{padding:12px 14px 14px;display:grid;gap:10px}
    .meta{display:flex;gap:6px;flex-wrap:wrap}
    .tag{background:var(--chip);border:1px solid var(--border);color:#b9bfd7;border-radius:999px;padding:3px 8px;font-size:11.5px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{flex:1;text-align:center;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#151723;color:#e6e9f6;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(180deg,#2f3cff,#6f86ff);border:none}
    .btn.link{background:#0d1117;color:#9fb4ff;text-decoration:underline;flex:1}
    .pricebox{display:flex;flex-direction:column;gap:4px}
    .line{display:flex;align-items:baseline;gap:8px;flex-wrap:wrap}
    .oldprice{color:#9aa2b2;text-decoration:line-through;font-size:13px}
    .newprice{color:var(--warn);font-size:18px;font-weight:800}
    .save{color:var(--ok);font-weight:800;font-size:12.5px}
    .thumbs{display:flex;gap:6px;flex-wrap:wrap}
    .thumbs img{width:56px;height:42px;object-fit:cover;border:1px solid var(--border);border-radius:8px;opacity:.85;cursor:pointer}
    .thumbs img.active{outline:2px solid var(--brand);opacity:1}
    footer{margin-top:18px;color:var(--muted);font-size:12px;display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
    .count{color:#a6add0}
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.86);display:none;align-items:center;justify-content:center;z-index:9999}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw;max-height:86vh;object-fit:contain}
    .lb-nav{position:fixed;inset:0;display:flex;align-items:center;justify-content:space-between;pointer-events:none}
    .lb-btn{pointer-events:auto;user-select:none;cursor:pointer;background:rgba(255,255,255,.12);border:1px solid #555;color:#fff;padding:10px 14px;border-radius:12px;margin:0 14px;font-weight:800}
    .lb-close{position:fixed;top:16px;right:16px}
    /* 新增：公告 + 倒计时 */
    .notice{display:flex;gap:12px;justify-content:space-between;align-items:center;border:1px solid var(--border);background:#10121a;border-radius:12px;padding:10px 12px;margin-top:8px}
    .notice-text{font-size:13.5px;color:#cfd3e4}
    .notice-timer{text-align:right;min-width:220px}
    .notice-timer small{display:block;color:var(--muted);margin-bottom:2px}
    #countdown{font-weight:900;font-size:14.5px;color:var(--ok);letter-spacing:.3px}
    @media(max-width:640px){.notice{flex-direction:column;align-items:flex-start}.notice-timer{text-align:left;min-width:auto;width:100%}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <h1>二手物品清单</h1>
        <span class="subtitle">支持多图 · 价格对比 · 分类筛选 · 参考链接</span>
      </div>
      <div class="toolbar"><span id="count">0 items</span> · <span id="contact"></span></div>
      <div class="filter">
        <label for="categoryFilter">分类：</label>
        <select id="categoryFilter">
          <option value="all">全部</option>
        </select>
      </div>
      <!-- 新增：中英双语欢迎语 + 到 10/03 的倒计时 -->
      <div class="notice" aria-live="polite">
        <div class="notice-text">
          <strong>Hi～终于等到你！</strong> 欢迎光临 Lina 的二手杂货铺：毕业出 家具 / 学习用品 / 衣物 等，先到先得。<br>
          <em>Welcome!</em> Lina’s preloved shop — furniture, study supplies & clothing. First come, first served.
        </div>
        <div class="notice-timer">
          <small>距 10/03 截止 · Closes by Oct 3</small>
          <div id="countdown">-- 天 --:--:-- / --d --:--:--</div>
        </div>
      </div>
    </header>

    <section class="grid" id="grid"></section>
  </div>

  <div class="lightbox" id="lightbox">
    <button class="lb-btn lb-close" id="lbClose">✕</button>
    <img id="lbImg" alt="preview" />
    <div class="lb-nav">
      <button class="lb-btn" id="lbPrev">◀</button>
      <button class="lb-btn" id="lbNext">▶</button>
    </div>
  </div>

  <script>
    const I18N={ zh:{btnCopy:'复制链接',btnWant:'我想要',btnLink:'参考链接',priceOld:'原价',priceNow:'现价',priceSave:'节省'}, en:{btnCopy:'Copy link',btnWant:'I want it',btnLink:'Reference link',priceOld:'Original',priceNow:'Now',priceSave:'Save'}, it:{btnCopy:'Copia link',btnWant:'Mi interessa',btnLink:'Link di riferimento',priceOld:'Prezzo originale',priceNow:'Prezzo attuale',priceSave:'Risparmi'} };
    const LANG='zh';
    const seller={ contact:'WeChat: your_wechat · Email: meii.della.serena@gmail.com', defaultCurrency:'EUR' };
    const $=s=>document.querySelector(s); const byId=id=>document.getElementById(id);
    function fmt(n,c){try{return new Intl.NumberFormat(undefined,{style:'currency',currency:c,maximumFractionDigits:n%1?2:0}).format(n)}catch(e){return `${c} ${n}`}}
    function saveCalc(it){const o=Number(it.originalPrice||0),p=Number(it.price||0);if(!o||!p||p>=o)return null;const s=o-p;const r=Math.round(s/o*100);return{s,pct:r}}

    // Lightbox
    const lbEl=byId('lightbox'); const lbImg=byId('lbImg'); const lbPrev=byId('lbPrev'); const lbNext=byId('lbNext'); const lbClose=byId('lbClose');
    let lbList=[], lbIdx=0;
    function openLB(list,start=0){ lbList=list; lbIdx=start; lbImg.src=lbList[lbIdx]; lbEl.classList.add('open'); }
    function closeLB(){ lbEl.classList.remove('open'); }
    function navLB(d){ if(!lbList.length) return; lbIdx=(lbIdx+d+lbList.length)%lbList.length; lbImg.src=lbList[lbIdx]; }
    lbPrev.onclick=()=>navLB(-1); lbNext.onclick=()=>navLB(1); lbClose.onclick=closeLB; lbEl.addEventListener('click',e=>{ if(e.target===lbEl) closeLB(); });
    document.addEventListener('keydown',e=>{ if(!lbEl.classList.contains('open')) return; if(e.key==='Escape') closeLB(); if(e.key==='ArrowLeft') navLB(-1); if(e.key==='ArrowRight') navLB(1); });

    function chip(text){const s=document.createElement('span'); s.className='tag'; s.textContent=text; return s;}

    function createCard(item){
      const dict=I18N[LANG]; const currency=item.currency||seller.defaultCurrency;
      const el=document.createElement('article'); el.className='card'; el.id=item.id||('item-'+Math.random().toString(36).slice(2,8));
      const mainImg=item.img || (item.gallery&&item.gallery[0]);
      const savings=saveCalc(item);
      el.innerHTML=`
        <div class="media">
          <img class="thumb" src="${mainImg}" alt="${item.title}" onerror="this.onerror=null;this.src='assets/placeholder.jpg';">
          <div class="badge">${fmt(item.price,currency)}</div>
        </div>
        <div class="content">
          <h3 class="itemTitle" style="margin:0;font-size:17px">${item.title}</h3>
          <div class="desc" style="color:#cfd3e4;font-size:13.5px">${item.desc||''}</div>
          ${item.originalPrice? `<div class='pricebox'><div class='line'><span class='oldprice'>${dict.priceOld}: ${fmt(item.originalPrice,currency)}</span><span class='newprice'>${dict.priceNow}: ${fmt(item.price,currency)}</span>${savings? `<span class='save'>${dict.priceSave}: ${fmt(savings.s,currency)} (~${savings.pct}%)</span>`:''}</div></div>`:''}
          <div class="meta"></div>
          <div class="thumbs"></div>
          <div class="actions">
            <button class="btn" data-copy="#${el.id}">${dict.btnCopy}</button>
            <a class="btn primary" href="mailto:?subject=${encodeURIComponent('Inquiry: '+item.title)}&body=${encodeURIComponent(location.href.split('#')[0]+'#'+el.id)}">${dict.btnWant}</a>
            ${item.link? `<a class="btn link" href="${item.link}" target="_blank" rel="noopener noreferrer">${dict.btnLink}</a>`:''}
          </div>
        </div>`;

      const meta=el.querySelector('.meta');
      if(item.category) meta.appendChild(chip(item.category));
      if(item.condition) meta.appendChild(chip(item.condition));
      if(item.location) meta.appendChild(chip(item.location));
      if(item.status) meta.appendChild(chip(item.status));

      if(Array.isArray(item.gallery) && item.gallery.length){
        const bar=el.querySelector('.thumbs');
        const cover=el.querySelector('.thumb');
        item.gallery.forEach((src,idx)=>{
          const t=document.createElement('img'); t.src=src; t.alt=item.title+'-'+(idx+1);
          if(src===cover.getAttribute('src')) t.classList.add('active');
          t.addEventListener('click',()=>{
            cover.src=src;
            bar.querySelectorAll('img').forEach(i=>i.classList.remove('active'));
            t.classList.add('active');
          });
          bar.appendChild(t);
        });
      }

      el.querySelector('[data-copy]').addEventListener('click',e=>{
        const h=e.currentTarget.getAttribute('data-copy'); const url=location.href.split('#')[0]+h;
        navigator.clipboard?.writeText(url).then(()=>{e.currentTarget.textContent='✔'; setTimeout(()=>e.currentTarget.textContent=dict.btnCopy,900)});
      });

      el.querySelector('.thumb').addEventListener('click',()=>{
        const list = (Array.isArray(item.gallery)&&item.gallery.length)? item.gallery : [mainImg];
        const current = el.querySelector('.thumb').getAttribute('src');
        const startIndex = Math.max(0, list.indexOf(current));
        openLB(list, startIndex);
      });

      return el;
    }

    function render(data,filterCat='all'){
      const grid=byId('grid'); grid.innerHTML='';
      const items=data.items.filter(it=> filterCat==='all' || it.category===filterCat);
      items.forEach(it=> grid.appendChild(createCard(it)));
      byId('count').textContent = `${items.length} items`;
      byId('contact').innerHTML = seller.contact;
      if(location.hash){ document.querySelector(location.hash)?.scrollIntoView({behavior:'smooth',block:'center'}); }
    }

    function setup(data){
      if(!data || !data.items){ console.error('缺少数据 window.APP_DATA'); return; }
      const categories=[...new Set(data.items.map(it=>it.category).filter(Boolean))];
      const sel=byId('categoryFilter');
      categories.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o); });
      sel.addEventListener('change',()=>render(data,sel.value));
      render(data);
    }

    // 新增：到 2025-10-03 的倒计时（以浏览器本地时区计算）
    function startCountdown(){
      const el=byId('countdown'); if(!el) return;
      const deadline=new Date('2025-10-03T23:59:59'); // 本地时间 10/03 23:59:59
      function pad(n){return String(n).padStart(2,'0');}
      function tick(){
        const now=new Date();
        const ms=deadline-now;
        if(ms<=0){ el.textContent='已结束 / Closed'; el.style.color='#ff9aa2'; clearInterval(t); return; }
        const sec=Math.floor(ms/1000)%60;
        const min=Math.floor(ms/1000/60)%60;
        const hr =Math.floor(ms/1000/60/60)%24;
        const day=Math.floor(ms/1000/60/60/24);
        el.textContent=`${day} 天 ${pad(hr)}:${pad(min)}:${pad(sec)} / ${day}d ${pad(hr)}:${pad(min)}:${pad(sec)}`;
      }
      tick();
      const t=setInterval(tick,1000);
    }
    document.addEventListener('DOMContentLoaded', startCountdown);
  </script>

  <script>
    if(window.APP_DATA){
      setup(window.APP_DATA);
    } else {
      console.warn('window.APP_DATA 未定义，请在此处插入数据对象');
    }
  </script>
</body>
</html>
